

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon.png">
  <link rel="icon" href="/img/icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Lai Baijiang">
  <meta name="keywords" content="">
  
    <meta name="description" content="1. 索引概述索引（index）是帮助MySQL**高效获取数据的数据结构(有序)**。 在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。 2. 索引演示有一张user表，如果此时执行SQL语句： select * from user where age &#x3D; 45;  无索引：此时">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL-进阶-索引">
<meta property="og:url" content="https://baijianglai.cn/MySQL-%E8%BF%9B%E9%98%B6-%E7%B4%A2%E5%BC%95/67c1cc216a26/index.html">
<meta property="og:site_name" content="Lai">
<meta property="og:description" content="1. 索引概述索引（index）是帮助MySQL**高效获取数据的数据结构(有序)**。 在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。 2. 索引演示有一张user表，如果此时执行SQL语句： select * from user where age &#x3D; 45;  无索引：此时">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/57cc61ede90b2dd292b952edaa65386a.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/a8c8dbcef06ac6eed3ca4f7965abf706.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/adc39765a8424aeed9584a054941ac95.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/cde74cc64474f37b88548b78a1bb2e19.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/338e4d70bc77603b7c1b9a4d91d3d42b.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/06b719f39658f474f214e158afc3b292.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/9d97f29a92b3c65adeed91875fcf75c1.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/21b14f7ca29f22a8a3259ed9e89a3971.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/cc79272e08ac00965e69ef23d9d04c84.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/bd0a483e299531b56530aaba5379280a.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/baf9b3f5736e5a63ea5df60e2fc8c111.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/1b5cf867bd0e417e0b5e410cbca070b7.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/4035ae9268a36174c3fb2fa42b1a0bde.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/d5b5d2e4081f808a023c09414af7c72c.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/2c8055238d11e739cbe98509b127fce4.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/cce6ee62f7af44416396c57ac4cfccd7.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/477e9af3f57c81d84c40238e4c00a4b0.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/b9ba34f0cbef7ce8fc6b15251b30b564.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/1e6fc6a816beec398894d46f512af8f6.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/7dd73e5adab26e133d6f5aa49bf03184.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/23a82fa89cbdf1fc2465a2a59a48f0f7.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/61d470575f7ff289d39ae6854e226bc9.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/7d4367ac8f5f0353380659b577b5412d.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/6e2413507c125ae5e921ab1085218624.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/a5d69f164b159d9cc49cf7dff7a5042c.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/4142f4e2e8d283d0f2e5d7c16ac0088d.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/346a5e4ee72cd2f3952319faf643311b.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/4f220b196962ea73c20c0c0a67dcc5b9.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/ac54bd5da51df48cd26939620844ca8e.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/e54bff44f86b8192deea5cc0e7d5faac.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/99de71cee9fdd4b894764462c0985800.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/03c495eb8f47fa91122218821cb49bcb.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/0e56981ca58f799b94e9cfeda43f0240.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/bf5a36c1c9081fad0536c6fb707003f7.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/1021558291e767b4814080bf85be198b.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/eaddba6aa5c02202625df2cc83c75252.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/3960ace0dfa801a387d3926209bf4b67.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/642d1e400bc18a4316c888b776c11019.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/aa6ece6a1be99c3270ddf7f499f8fb9d.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/10e1ae544d36b025211d438df875bc69.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/04404f21a3a11c0333a49229f2211a24.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/21d25f60469c92a04d0dc7e661d1d56e.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/34f43c3842db06ce1df3ff4aa7c29001.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/c8bbb8096e9488316a805baaa0f7322c.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/ff43e8af4fdb141f045a10beacbba736.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/d2117d1cbacca3fc3153bda61b317e7e.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/7276d259290cbe9d1ec6d1e73bde0c1f.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/458c2f840c087d0185c142a52f187b60.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/8296044054c14a2068fd15901b0fa1a7.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/88e73c179fc43ea2e54de3689bff4d1c.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/41962cfc00054e66135e917fcf0359ad.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/d04ddd7dae3a62ffc097009aa49e2d8a.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/7fb6608961f507cc3fb711fcf3b87d1c.png">
<meta property="og:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/d7ae8e87756a8c0472a4465883f9370c.png">
<meta property="article:published_time" content="2024-04-24T08:24:17.000Z">
<meta property="article:modified_time" content="2024-04-28T14:11:33.562Z">
<meta property="article:author" content="Lai Baijiang">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/57cc61ede90b2dd292b952edaa65386a.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>MySQL-进阶-索引 - Lai</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"baijianglai.cn","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Lai</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MySQL-进阶-索引"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-04-24 16:24" pubdate>
          2024年4月24日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          13k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          29 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">MySQL-进阶-索引</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="1-索引概述"><a href="#1-索引概述" class="headerlink" title="1. 索引概述"></a>1. 索引概述</h1><p>索引（index）是帮助MySQL**高效获取数据的数据结构(有序)**。</p>
<p>在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</p>
<h1 id="2-索引演示"><a href="#2-索引演示" class="headerlink" title="2. 索引演示"></a>2. 索引演示</h1><p>有一张user表，如果此时执行SQL语句：<code> select * from user where age = 45;</code></p>
<ul>
<li>无索引：此时由于没有在age上存放索引，那么这个sql就从第一行开始扫描，一直扫描到最后一行，即：全表扫描。性能极低。</li>
<li>有索引：在age字段上建立索引，会创建一个类似二叉树一样的东西（真实结构为B+树），这样极大的加快了检索速度。</li>
</ul>
<h1 id="3-索引特点"><a href="#3-索引特点" class="headerlink" title="3. 索引特点"></a>3. 索引特点</h1><p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/57cc61ede90b2dd292b952edaa65386a.png" srcset="/img/loading.gif" lazyload alt="image-20230410223027709"></p>
<h1 id="4-索引结构"><a href="#4-索引结构" class="headerlink" title="4. 索引结构"></a>4. 索引结构</h1><h2 id="4-1-介绍"><a href="#4-1-介绍" class="headerlink" title="4.1 介绍"></a>4.1 介绍</h2><p><strong>MySQL的索引是在存储引擎层实现的</strong>，不同的存储引擎有不同的索引结构</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/a8c8dbcef06ac6eed3ca4f7965abf706.png" srcset="/img/loading.gif" lazyload alt="image-20230410223312985"></p>
<p>不同的存储引擎对索引结构的支持：</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/adc39765a8424aeed9584a054941ac95.png" srcset="/img/loading.gif" lazyload alt="image-20230410223456722"></p>
<blockquote>
<p>平常所说的索引，如果没有特别指明，都是指B+树结构组织的索引。</p>
</blockquote>
<h2 id="4-2-二叉树"><a href="#4-2-二叉树" class="headerlink" title="4.2 二叉树"></a>4.2 二叉树</h2><p>当二叉树作为索引结构，存在以下缺点：</p>
<ul>
<li>顺序插入时，会形成一个<strong>链表，查询性能大大降低</strong>。</li>
<li>大数据量情况下，<strong>层级较深，检索速度慢</strong>。</li>
</ul>
<h2 id="4-3-红黑树"><a href="#4-3-红黑树" class="headerlink" title="4.3 红黑树"></a>4.3 红黑树</h2><p>红黑树是一颗<strong>自平衡二叉树</strong>，那这样即使是顺序插入数据，最终形成的数据结构也是一颗平衡的二叉树。</p>
<p>所以红黑树作为索引结构也会存在一个缺点：大数据量情况下，<strong>层级较深，检索速度慢</strong>。</p>
<h2 id="4-4-B树"><a href="#4-4-B树" class="headerlink" title="4.4 B树"></a>4.4 B树</h2><p>B树是一种<strong>多叉路衡查找树</strong>，相对于二叉树，<strong>B树每个节点可以有多个分支，即多叉。</strong></p>
<p>以一颗最大度数（max-degree）为<strong>5(5阶)的b-tree</strong>为例，那这个B树<strong>（每个节点最多存储4个key，5个指针）</strong>：</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/cde74cc64474f37b88548b78a1bb2e19.png" srcset="/img/loading.gif" lazyload alt="image-20230410224950819"></p>
<blockquote>
<p>树的度数指的是一个节点的子节点个数。（有n个key，就有n+1个指针）</p>
</blockquote>
<h3 id="4-4-1-特点"><a href="#4-4-1-特点" class="headerlink" title="4.4.1 特点"></a>4.4.1 特点</h3><ul>
<li>n阶的B树，每一个节点最多存储n-1个key，对应n个指针。</li>
<li><strong>一旦节点存储的key数量到达n，就会裂变，中间元素向上分裂。</strong></li>
<li>在B树中，<strong>非叶子节点和叶子节点都会存放数据。</strong></li>
</ul>
<h2 id="4-5-B-树"><a href="#4-5-B-树" class="headerlink" title="4.5 B+树"></a>4.5 B+树</h2><p>B+Tree是B-Tree的变种，我们以一颗最大度数（max-degree）为4（4阶）的b+tree为例，来看一下其结构示意图：</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/338e4d70bc77603b7c1b9a4d91d3d42b.png" srcset="/img/loading.gif" lazyload alt="image-20230410230124036"></p>
<blockquote>
<ul>
<li>绿色框框起来的部分，是<strong>索引部分，仅仅起到索引数据的作用，不存储数据。</strong></li>
<li>红色框框起来的部分，是<strong>数据存储部分，在其叶子节点中要存储具体的数据。</strong></li>
</ul>
</blockquote>
<h3 id="4-5-1-与B树区别"><a href="#4-5-1-与B树区别" class="headerlink" title="4.5.1 与B树区别"></a>4.5.1 与B树区别</h3><ul>
<li><strong>所有的数据都会出现在叶子节点。</strong></li>
<li>叶子节点<strong>形成一个单向链表</strong>。</li>
<li>非叶子节点仅仅起到索引数据作用，具体的数据都是在叶子节点存放的。</li>
</ul>
<h3 id="4-5-2-MySQL索引数据结构"><a href="#4-5-2-MySQL索引数据结构" class="headerlink" title="4.5.2 MySQL索引数据结构"></a>4.5.2 MySQL索引数据结构</h3><p>在B+树上进行优化，<strong>在原B+Tree的基础上，增加一个指向相邻叶子节点的链表指针，就形成了带有顺序指针的B+Tree，提高区间访问的性能，利于排序。</strong></p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/06b719f39658f474f214e158afc3b292.png" srcset="/img/loading.gif" lazyload alt="image-20230410230844291"></p>
<h2 id="4-6-Hash"><a href="#4-6-Hash" class="headerlink" title="4.6 Hash"></a>4.6 Hash</h2><p>哈希索引就是采用一定的hash算法，将键值换算成新的hash值，映射到对应的槽位上，然后存储在 hash表中。</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/9d97f29a92b3c65adeed91875fcf75c1.png" srcset="/img/loading.gif" lazyload alt="image-20230411203125845"></p>
<p><strong>当出现两个(或多个)键值，映射到一个相同的槽位上，他们就产生了hash冲突（也称为hash碰撞）</strong>，可以通过<strong>链表</strong>来解决。</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/21b14f7ca29f22a8a3259ed9e89a3971.png" srcset="/img/loading.gif" lazyload alt="image-20230411203219634"></p>
<h3 id="4-6-1-特点"><a href="#4-6-1-特点" class="headerlink" title="4.6.1 特点"></a>4.6.1 特点</h3><ul>
<li>Hash索引**只能用于对等比较(&#x3D;，in)**，不支持范围查询（between，&gt;，&lt; ，…）</li>
<li><strong>无法利用索引完成排序操作</strong></li>
<li><strong>查询效率高</strong>，通常(不存在hash冲突的情况)只需要一次检索就可以了，效率通常要高于B+tree索引</li>
</ul>
<blockquote>
<p>在MySQL中，支持hash索引的是Memory存储引擎。 <strong>而InnoDB中具有自适应hash功能，hash索引是 InnoDB存储引擎根据B+Tree索引在指定条件下自动构建的。</strong></p>
</blockquote>
<h2 id="4-7-MySQL为何选择B-树作为索引结构"><a href="#4-7-MySQL为何选择B-树作为索引结构" class="headerlink" title="4.7 MySQL为何选择B+树作为索引结构"></a>4.7 MySQL为何选择B+树作为索引结构</h2><ul>
<li>相对于二叉树，<strong>层级更少，搜索效率高</strong>；</li>
<li>对于B-tree，<strong>无论是叶子节点还是非叶子节点，都会保存数据</strong>，这样导致一页中存储的键值减少，指针跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低；</li>
<li>相对Hash索引，<strong>B+tree支持范围匹配及排序操作</strong>；</li>
</ul>
<h1 id="5-索引分类"><a href="#5-索引分类" class="headerlink" title="5. 索引分类"></a>5. 索引分类</h1><p>在MySQL数据库，将索引的具体类型主要分为以下几类：主键索引、唯一索引、常规索引、全文索引。</p>
<p><strong><img src="https://img-blog.csdnimg.cn/img_convert/cc79272e08ac00965e69ef23d9d04c84.png" srcset="/img/loading.gif" lazyload alt="image-20230411214416027"></strong></p>
<h2 id="5-1-聚集索引-二级索引"><a href="#5-1-聚集索引-二级索引" class="headerlink" title="5.1 聚集索引&amp;二级索引"></a>5.1 聚集索引&amp;二级索引</h2><p>在InnoDB存储引擎中，根据索引的存储形式，可以分为以下两种：</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/bd0a483e299531b56530aaba5379280a.png" srcset="/img/loading.gif" lazyload alt="image-20230411214529881"></p>
<h3 id="5-1-1-聚集索引选取规则"><a href="#5-1-1-聚集索引选取规则" class="headerlink" title="5.1.1 聚集索引选取规则"></a>5.1.1 聚集索引选取规则</h3><blockquote>
<p>主键-&gt;唯一（unique）-&gt;rowid</p>
</blockquote>
<ul>
<li>如果<strong>存在主键，主键索引就是聚集索引。</strong></li>
<li>如果不存在主键，将使用<strong>第一个唯一（UNIQUE）索引作为聚集索引。</strong></li>
<li>如果表没有主键，或没有合适的唯一索引，则<strong>InnoDB会自动生成一个rowid作为隐藏的聚集索引。且聚集索引在一个表里只会有一个</strong></li>
</ul>
<h3 id="5-1-2-聚集索引-二级索引结构"><a href="#5-1-2-聚集索引-二级索引结构" class="headerlink" title="5.1.2 聚集索引&amp;二级索引结构"></a>5.1.2 聚集索引&amp;二级索引结构</h3><p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/baf9b3f5736e5a63ea5df60e2fc8c111.png" srcset="/img/loading.gif" lazyload alt="image-20230411215242874"></p>
<p>观察可以得知：</p>
<ul>
<li><strong>聚集</strong>索引的叶子节点下挂的是<strong>这一行的数据</strong>。</li>
<li><strong>二级</strong>索引的叶子节点下挂的是<strong>该字段值对应的主键值</strong>。</li>
</ul>
<h3 id="5-1-3-执行SQL过程"><a href="#5-1-3-执行SQL过程" class="headerlink" title="5.1.3 执行SQL过程"></a>5.1.3 执行SQL过程</h3><p>在执行sql：<code>select * from user where name = &#39;Arm&#39;;</code>过程：</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/1b5cf867bd0e417e0b5e410cbca070b7.png" srcset="/img/loading.gif" lazyload alt="image-20230411220116187"></p>
<blockquote>
<p>文字描述：</p>
<ol>
<li>由于是根据name字段进行查询，所以先根据name&#x3D;’Arm’到name字段的二级索引中进行匹配查找。但是在二级索引中只能查找到 Arm 对应的主键值 10。</li>
<li>由于查询返回的数据是*，所以此时，还需要根据主键值10，到聚集索引中查找10对应的记录，最终找到10对应的行row。</li>
<li>最终拿到这一行的数据，直接返回即可。</li>
</ol>
</blockquote>
<h3 id="5-1-4-回表查询"><a href="#5-1-4-回表查询" class="headerlink" title="5.1.4 回表查询"></a>5.1.4 回表查询</h3><p><strong>先到二级索引中查找数据，找到主键值</strong>，然后<strong>再到聚集索引中根据主键值，获取数据的方式</strong>，就称之为回表查询。</p>
<h3 id="5-1-5-比较"><a href="#5-1-5-比较" class="headerlink" title="5.1.5 比较"></a>5.1.5 比较</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">A. <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> ; <br>B. <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Arm&#x27;</span> ; <br>备注: id为主键，name字段创建的有索引；<br></code></pre></td></tr></table></figure>

<p>A 语句的执行性能要高于 B 语句。</p>
<p>因为A语句直接<strong>走聚集索引，直接返回数据。</strong></p>
<p>而B语句需要先查询name字段的二级索引，然后再查询聚集索引，也就是需要进行回表查询。</p>
<h3 id="5-1-6-InnoDB主键索引的B-树高度多少"><a href="#5-1-6-InnoDB主键索引的B-树高度多少" class="headerlink" title="5.1.6 InnoDB主键索引的B+树高度多少"></a>5.1.6 InnoDB主键索引的B+树高度多少</h3><p>假设：一行数据大小为1k，一页中可以存储16行这样的数据。InnoDB的指针占用6个字节的空间，主键即使为bigint，占用字节数为8。</p>
<blockquote>
<p>高度为2：</p>
<p>n * 8 + (n + 1) * 6 &#x3D; 16 * 1024 , 算出n约为 1170</p>
<p>n 为这个节点存储的key的数量</p>
<p>8 为主键占用的字节数</p>
<p>n+1 指代的是指针的数量</p>
<p>6 为InnoDB的指针占用的空间</p>
<p>16 * 1024 一页的大小是16k，所以是16 * 1024个字节</p>
<p>1171*16 &#x3D; 18736</p>
<p>1170 为这个节点存储的key，可以知道就会有1171个指针</p>
<p>每一个指针会指向下面的子节点，每个节点因为能放16行数据</p>
<p>也就是说，如果树的高度为2，则可以存储 18000 多条记录。</p>
</blockquote>
<blockquote>
<p>高度为3：</p>
<p>1171 * 1171 * 16 &#x3D; 21939856</p>
<p>多了一个高度，相当于又有1171个指针指向下面，因此直接用1171乘以上面的结果即可</p>
<p>也就是说，如果树的高度为3，则可以存储 2200w 左右的记录。</p>
</blockquote>
<h1 id="6-索引语法"><a href="#6-索引语法" class="headerlink" title="6. 索引语法"></a>6. 索引语法</h1><h2 id="6-1-创建索引"><a href="#6-1-创建索引" class="headerlink" title="6.1 创建索引"></a>6.1 创建索引</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> [ <span class="hljs-keyword">UNIQUE</span> <span class="hljs-operator">|</span> FULLTEXT ] INDEX index_name <span class="hljs-keyword">ON</span> table_name (index_col_name,... ) ;<br></code></pre></td></tr></table></figure>

<h2 id="6-2-查看索引"><a href="#6-2-查看索引" class="headerlink" title="6.2 查看索引"></a>6.2 查看索引</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> INDEX <span class="hljs-keyword">FROM</span> table_name ;<br></code></pre></td></tr></table></figure>

<h2 id="6-3-删除索引"><a href="#6-3-删除索引" class="headerlink" title="6.3 删除索引"></a>6.3 删除索引</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> INDEX index_name <span class="hljs-keyword">ON</span> table_name ;<br></code></pre></td></tr></table></figure>



<h1 id="7-SQL性能分析"><a href="#7-SQL性能分析" class="headerlink" title="7. SQL性能分析"></a>7. SQL性能分析</h1><h2 id="7-1-SQL执行频率"><a href="#7-1-SQL执行频率" class="headerlink" title="7.1 SQL执行频率"></a>7.1 SQL执行频率</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> status <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;com_______&#x27;</span>;<br>#session 是查看当前会话 ;<br>#<span class="hljs-keyword">global</span> 是查询全局数据 ;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/4035ae9268a36174c3fb2fa42b1a0bde.png" srcset="/img/loading.gif" lazyload alt="image-20230412211950972"></p>
<blockquote>
<ul>
<li>Com_delete: 删除次数</li>
<li>Com_insert: 插入次数</li>
<li>Com_select: 查询次数</li>
<li>Com_update: 更新次数</li>
</ul>
<p> 通过上述指令，我们可以查看到当前数据库到底是以查询为主，还是以增删改为主，从而为数据库优化提供参考依据。 如果是以增删改为主，我们可以考虑不对其进行索引的优化。 <strong>如果是以查询为主，那么就要考虑对数据库的索引进行优化了。</strong>次数我们可以借助于慢查询 日志。</p>
</blockquote>
<h2 id="7-2-慢查询日志"><a href="#7-2-慢查询日志" class="headerlink" title="7.2 慢查询日志"></a>7.2 慢查询日志</h2><p>慢查询日志记录了<strong>所有执行时间超过指定参数（long_query_time，单位：秒，默认10秒）的所有 SQL语句的日志。</strong></p>
<p> MySQL的慢查询日志默认没有开启，我们可以查看一下系统变量 slow_query_log。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">#查看系统变量 slow_query_log<br># variables 意思是变量<br><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;slow_query_log&#x27;</span>;<br></code></pre></td></tr></table></figure>



<h3 id="7-2-1-开启慢查询日志"><a href="#7-2-1-开启慢查询日志" class="headerlink" title="7.2.1 开启慢查询日志"></a>7.2.1 开启慢查询日志</h3><p>需要在MySQL的配置文件（&#x2F;etc&#x2F;my.cnf）中配置</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">#使用vi编辑器打开配置文件（在使用前先输入exit退出mysql程序）<br>vi <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>my.cnf<br><br>#接着按G到文章的最后位置，将下面内容输入进去，并且保存并退出<br><br># 开启MySQL慢日志查询开关<br>slow_query_log<span class="hljs-operator">=</span><span class="hljs-number">1</span><br># 设置慢日志的时间为<span class="hljs-number">2</span>秒，<span class="hljs-keyword">SQL</span>语句执行时间超过<span class="hljs-number">2</span>秒，就会视为慢查询，记录慢查询日志<br>long_query_time<span class="hljs-operator">=</span><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>



<p>修改之后重启MySQL服务器</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">systemctl restart mysqld<br><br>#再次查询慢查询日志<br><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;slow_query_log&#x27;</span>;<br></code></pre></td></tr></table></figure>



<ul>
<li><p>检查慢查询日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">tail <span class="hljs-operator">-</span>f ‘主机名’<span class="hljs-operator">-</span>slow.log<br>#‘主机名’要更换成你自己的主机<br></code></pre></td></tr></table></figure>

<blockquote>
<p>如果不确定此处应填什么，可以先转到mysql目录下，再使用 ll 查看，往下拉，找到一个以-slow.log文件即可</p>
</blockquote>
</li>
<li><p>执行SQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user; <br>#这条<span class="hljs-keyword">SQL</span>执行效率比较高, 执行耗时 <span class="hljs-number">0.00</span>sec<br></code></pre></td></tr></table></figure>

<blockquote>
<p>最终我们发现，在慢查询日志中，只会记录执行时间超多我们预设时间（2s）的SQL，执行较快的SQL 是不会记录的。这样通过慢查询日志，就可以定位出执行效率比较低的SQL，从而有针对性的进行优化。</p>
</blockquote>
</li>
</ul>
<h2 id="7-3-Profile"><a href="#7-3-Profile" class="headerlink" title="7.3 Profile"></a>7.3 Profile</h2><p>show profiles 能够在做SQL优化时帮助我们了解时间都耗费到哪里去了。</p>
<ul>
<li><p>使用<code>select @@have_profiling ;</code>查看当前的MYSQL是否支持profile操作。</p>
</li>
<li><p>使用<code>select @@profiling;</code>查询 profile 的开关是开启还是关闭。（0-关闭；1-开启）</p>
<blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">#通过<span class="hljs-keyword">set</span>语句在 session<span class="hljs-operator">/</span><span class="hljs-keyword">global</span> 级别开启profiling<br><span class="hljs-keyword">set</span> profiling <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>#查询profile操作是否可以运行<br><span class="hljs-keyword">select</span> @<span class="hljs-variable">@have_profiling</span> ;<br></code></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<h3 id="7-3-1-查看每一条SQL耗时情况"><a href="#7-3-1-查看每一条SQL耗时情况" class="headerlink" title="7.3.1 查看每一条SQL耗时情况"></a>7.3.1 查看每一条SQL耗时情况</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> profiles;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/d5b5d2e4081f808a023c09414af7c72c.png" srcset="/img/loading.gif" lazyload alt="image-20230412220631780"></p>
<h3 id="7-3-2-指定query-id查看各阶段耗时情况"><a href="#7-3-2-指定query-id查看各阶段耗时情况" class="headerlink" title="7.3.2 指定query_id查看各阶段耗时情况"></a>7.3.2 指定query_id查看各阶段耗时情况</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">#其中，query_id 需要替换成图中的数字<br><span class="hljs-keyword">show</span> profile <span class="hljs-keyword">for</span> query query_id;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/2c8055238d11e739cbe98509b127fce4.png" srcset="/img/loading.gif" lazyload alt="image-20230412220809805"></p>
<h3 id="7-3-3-指定query-id的SQL查看CPU使用情况"><a href="#7-3-3-指定query-id的SQL查看CPU使用情况" class="headerlink" title="7.3.3 指定query_id的SQL查看CPU使用情况"></a>7.3.3 指定query_id的SQL查看CPU使用情况</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">##其中，query_id 需要替换成图中的数字<br><span class="hljs-keyword">show</span> profile cpu <span class="hljs-keyword">for</span> query query_id;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/cce6ee62f7af44416396c57ac4cfccd7.png" srcset="/img/loading.gif" lazyload alt="image-20230412221119167"></p>
<h2 id="7-4-explain"><a href="#7-4-explain" class="headerlink" title="7.4 explain"></a>7.4 explain</h2><p>EXPLAIN 或者 DESC 命令<strong>获取 MySQL 如何执行 SELECT 语句的信息，包括在 SELECT 语句执行 过程中表如何连接和连接的顺序。</strong></p>
<h3 id="7-4-1-语法"><a href="#7-4-1-语法" class="headerlink" title="7.4.1 语法"></a>7.4.1 语法</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 直接在select语句之前加上关键字 explain / desc</span><br>EXPLAIN <span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件 ;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/477e9af3f57c81d84c40238e4c00a4b0.png" srcset="/img/loading.gif" lazyload alt="image-20230412221657326"></p>
<h3 id="7-4-2-字段含义"><a href="#7-4-2-字段含义" class="headerlink" title="7.4.2 字段含义"></a>7.4.2 字段含义</h3><p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/b9ba34f0cbef7ce8fc6b15251b30b564.png" srcset="/img/loading.gif" lazyload alt="image-20230412221852861"></p>
<h1 id="8-索引使用"><a href="#8-索引使用" class="headerlink" title="8. 索引使用"></a>8. 索引使用</h1><p>建立索引前后，查询数据的耗时不是一个量级的。</p>
<h2 id="8-1-最左前缀法则"><a href="#8-1-最左前缀法则" class="headerlink" title="8.1 最左前缀法则"></a>8.1 最左前缀法则</h2><p>如果<strong>索引了多列（联合索引），要遵守最左前缀法则</strong>。<strong>最左前缀法则指的是查询从索引的最左列开始， 并且不跳过索引中的列。如果跳跃某一列，索引将会部分失效(后面的字段索引失效)。</strong></p>
<p>以 tb_user 表为例，我们先来查看一下之前 tb_user 表所创建的索引。</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/1e6fc6a816beec398894d46f512af8f6.png" srcset="/img/loading.gif" lazyload alt="image-20230413220335527"></p>
<p>在该表存在一个联合索引，涉及的字段和顺序分别为：profession， age，status。</p>
<blockquote>
<p>对于最左前缀法则指的是，查询时，最左边的列，也就是profession必须存在，否则索引全部失效。 而且中间不能跳过某一列，否则该列后面的字段索引将失效。</p>
</blockquote>
<p> 接下来，我们来演示几组案例，看一下具体的执行计划：</p>
<h3 id="8-1-1-case1"><a href="#8-1-1-case1" class="headerlink" title="8.1.1 case1"></a>8.1.1 case1</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/7dd73e5adab26e133d6f5aa49bf03184.png" srcset="/img/loading.gif" lazyload alt="image-20230413220707964"></p>
<p>由于本次查询涉及到了三个字段，且左边的字段全部引用了，没有出现失效的情况，因此可能用到的索引和实际索引是一样的，索引的长度是54。</p>
<h3 id="8-1-2-case2"><a href="#8-1-2-case2" class="headerlink" title="8.1.2 case2"></a>8.1.2 case2</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/23a82fa89cbdf1fc2465a2a59a48f0f7.png" srcset="/img/loading.gif" lazyload alt="image-20230413221205946"></p>
<p>此时发现还是使用了联合索引</p>
<h3 id="8-1-3-case3"><a href="#8-1-3-case3" class="headerlink" title="8.1.3 case3"></a>8.1.3 case3</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/61d470575f7ff289d39ae6854e226bc9.png" srcset="/img/loading.gif" lazyload alt="image-20230413221722101"></p>
<p>经过这三个case发现，<strong>只要联合索引最左边的字段 profession存在，索引就会生效，只不过索引的长度不同。</strong> 而且由以上三组测试，我们也可以推测出profession字段索引长度为47、age 字段索引长度为2、status字段索引长度为5。</p>
<h3 id="8-1-4-case4"><a href="#8-1-4-case4" class="headerlink" title="8.1.4 case4"></a>8.1.4 case4</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/7d4367ac8f5f0353380659b577b5412d.png" srcset="/img/loading.gif" lazyload alt="image-20230413221916569"></p>
<p>此时发现并没有使用联合索引</p>
<h3 id="8-1-5-case5"><a href="#8-1-5-case5" class="headerlink" title="8.1.5 case5"></a>8.1.5 case5</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/6e2413507c125ae5e921ab1085218624.png" srcset="/img/loading.gif" lazyload alt="image-20230413222143846"></p>
<p>同样发现没有使用联合索引，因此，经过case4和case5得出结论：联合索引最左边的列profession不存在，不满足最左前缀法则，因此索引并未生效。</p>
<h3 id="8-1-6-case6"><a href="#8-1-6-case6" class="headerlink" title="8.1.6 case6"></a>8.1.6 case6</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/a5d69f164b159d9cc49cf7dff7a5042c.png" srcset="/img/loading.gif" lazyload alt="image-20230413222312813"></p>
<p>由于存在profession字段，<strong>最左边的列是存在的，索引满足最左前缀法则的基本条件。</strong>但是查询时，跳过了age这个列，所以后面的列索引是不会使用的，也就是<strong>索引部分生效</strong>，所以索引的长度就是47。</p>
<h3 id="8-1-7-case7"><a href="#8-1-7-case7" class="headerlink" title="8.1.7 case7"></a>8.1.7 case7</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">and</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/4142f4e2e8d283d0f2e5d7c16ac0088d.png" srcset="/img/loading.gif" lazyload alt="image-20230413222903216"></p>
<p>可以看到，是完全满足最左前缀法则的，索引长度54，联合索引是生效的。</p>
<blockquote>
<p>最左前缀法则中指的最左边的列，是指在查询时，联合索引的最左边的字段(即是 第一个字段)必须存在，<strong>与我们编写SQL时，条件编写的先后顺序无关。</strong></p>
</blockquote>
<h2 id="8-2-范围查询"><a href="#8-2-范围查询" class="headerlink" title="8.2 范围查询"></a>8.2 范围查询</h2><p><strong>联合索引中，出现范围查询(&gt;,&lt;)【即大于号、小于号、逗号】，范围查询右侧的列索引失效。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">30</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/346a5e4ee72cd2f3952319faf643311b.png" srcset="/img/loading.gif" lazyload alt="image-20230413223309116"></p>
<p>可看出现在走的是联合索引，且索引长度为49</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> status<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/4f220b196962ea73c20c0c0a67dcc5b9.png" srcset="/img/loading.gif" lazyload alt="image-20230413223422857"></p>
<p>可知现在已经走了联合索引，但是索引的长度为49，就说明当范围查询使用&gt; 或 &lt; 时，其右边的status字段是没有走索引的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;=</span> <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> status<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/ac54bd5da51df48cd26939620844ca8e.png" srcset="/img/loading.gif" lazyload alt="image-20230413223616911"></p>
<p>当范围查询使用&gt;&#x3D; 或 &lt;&#x3D; 时，走联合索引了，但是索引的长度为54，就说明所有的字段都是走索引的。</p>
<p> 所以，在业务允许的情况下，尽可能的使用类似于 &gt;&#x3D; 或 &lt;&#x3D; 这类的范围查询，而避免使用 &gt; 或 &lt; 。</p>
<h2 id="8-3-索引失效情况"><a href="#8-3-索引失效情况" class="headerlink" title="8.3 索引失效情况"></a>8.3 索引失效情况</h2><h3 id="8-3-1-索引列运算"><a href="#8-3-1-索引列运算" class="headerlink" title="8.3.1 索引列运算"></a>8.3.1 索引列运算</h3><p> <strong>不要在索引列上进行运算操作， 索引将失效。</strong></p>
<p> 在tb_user表中，除了前面介绍的联合索引之外，还有一个索引，是phone字段的单列索引。</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/e54bff44f86b8192deea5cc0e7d5faac.png" srcset="/img/loading.gif" lazyload alt="image-20230413224308379"></p>
<ol>
<li><p>当根据phone字段进行等值匹配查询时, 索引生效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990015&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/99de71cee9fdd4b894764462c0985800.png" srcset="/img/loading.gif" lazyload alt="image-20230413224502637"></p>
</li>
<li><p>当根据phone字段进行函数运算操作之后，索引失效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> <span class="hljs-built_in">substring</span>(phone,<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;15&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/03c495eb8f47fa91122218821cb49bcb.png" srcset="/img/loading.gif" lazyload alt="image-20230413224437774"></p>
<p>此时type为null，进行了全表扫描，说明索引失效。</p>
</li>
</ol>
<h3 id="8-3-2-字符串不加引号"><a href="#8-3-2-字符串不加引号" class="headerlink" title="8.3.2 字符串不加引号"></a>8.3.2 字符串不加引号</h3><p> <strong>字符串类型字段使用时，不加引号，索引将失效。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-number">17799990015</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-number">17799990015</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/0e56981ca58f799b94e9cfeda43f0240.png" srcset="/img/loading.gif" lazyload alt="image-20230413225621031"></p>
<p><strong>如果字符串不加单引号，对于查询结果，没什么影响，但是数据库存在隐式类型转换，索引将失效。</strong></p>
<h3 id="8-3-3-模糊查询"><a href="#8-3-3-模糊查询" class="headerlink" title="8.3.3 模糊查询"></a>8.3.3 模糊查询</h3><p>如果仅仅是<strong>尾部模糊匹配，索引不会失效</strong>。如果是<strong>头部模糊匹配，索引失效</strong>。</p>
<p>下面查询语句中，都是根据profession字段查询，符合最左前缀法则，联合索引是可以生效的， 我们主要看一下，模糊查询时，%加在关键字之前，和加在关键字之后的影响。</p>
<h4 id="8-3-3-1-case1"><a href="#8-3-3-1-case1" class="headerlink" title="8.3.3.1 case1"></a>8.3.3.1 case1</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;软件%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/bf5a36c1c9081fad0536c6fb707003f7.png" srcset="/img/loading.gif" lazyload alt="image-20230413230902741"></p>
<p>在like模糊查询中，在关键字后面加%，索引可以生效。</p>
<h4 id="8-3-3-2-case2"><a href="#8-3-3-2-case2" class="headerlink" title="8.3.3.2 case2"></a>8.3.3.2 case2</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%工程&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/1021558291e767b4814080bf85be198b.png" srcset="/img/loading.gif" lazyload alt="image-20230413231020746"></p>
<p>在关键字前面加了%，索引将会失效。</p>
<h4 id="8-3-3-3-case3"><a href="#8-3-3-3-case3" class="headerlink" title="8.3.3.3 case3"></a>8.3.3.3 case3</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%工%&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/eaddba6aa5c02202625df2cc83c75252.png" srcset="/img/loading.gif" lazyload alt="image-20230413231102647"></p>
<p><strong>在like模糊查询中，在关键字后面加%，索引可以生效。而如果在关键字前面加了%，索引将会失效。</strong></p>
<h3 id="8-3-4-or连接条件"><a href="#8-3-4-or连接条件" class="headerlink" title="8.3.4 or连接条件"></a>8.3.4 or连接条件</h3><p><strong>用or分割开的条件， 如果or前的条件中的列有索引，而后面的列中没有索引，那么涉及的索引都不会被用到。只有两侧都有索引，才会生效。</strong></p>
<h4 id="8-3-4-1-case1"><a href="#8-3-4-1-case1" class="headerlink" title="8.3.4.1 case1"></a>8.3.4.1 case1</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br><span class="hljs-comment">/**id主键索引，但是age没有索引**/</span><br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/3960ace0dfa801a387d3926209bf4b67.png" srcset="/img/loading.gif" lazyload alt="image-20230413231527972"></p>
<p>由于age没有索引，所以即使id有索引，索引也会失效。</p>
<h4 id="8-3-4-2-case2"><a href="#8-3-4-2-case2" class="headerlink" title="8.3.4.2 case2"></a>8.3.4.2 case2</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990017&#x27;</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br></code></pre></td></tr></table></figure>

<p>由于age没有索引，所以即使id、phone有索引，索引也会失效。所以需要针对于age也要建立索引。</p>
<h4 id="8-3-4-3-case3"><a href="#8-3-4-3-case3" class="headerlink" title="8.3.4.3 case3"></a>8.3.4.3 case3</h4><p>对age建立索引后</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_user_age <span class="hljs-keyword">on</span> tb_user(age);<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/642d1e400bc18a4316c888b776c11019.png" srcset="/img/loading.gif" lazyload alt="image-20230413232111132"></p>
<p><strong>最终，我们发现，当or连接的条件，左右两侧字段都有索引时，索引才会生效。</strong></p>
<h3 id="8-3-5-数据分布影响"><a href="#8-3-5-数据分布影响" class="headerlink" title="8.3.5 数据分布影响"></a>8.3.5 数据分布影响</h3><p>如果MySQL评估使用索引比全表更慢，则不使用索引。</p>
<p><strong>MySQL在查询时，会评估使用索引的效率与走全表扫描的效率，如果走全表扫描更快，则放弃索引，走全表扫描。 因为索引是用来索引少量数据的，如果通过索引查询返回大批量的数据，则还不如走全表扫描来的快，此时索引就会失效。</strong></p>
<blockquote>
<p>因此可能会出现一模一样的SQL语句，先后执行了两次，结果查询计划是不一样的，这是因为<strong>查询时MySQL会评估，走索引快，还是全表扫描快，如果全表 扫描更快，则放弃索引走全表扫描。 因此 is null 、is not null 是否走索引，得具体情况具体分析，并不是固定的。</strong></p>
</blockquote>
<h2 id="8-4-SQL提示"><a href="#8-4-SQL提示" class="headerlink" title="8.4 SQL提示"></a>8.4 SQL提示</h2><p>SQL提示，是优化数据库的一个重要手段，简单来说，就是在SQL语句中加入一些人为的提示来达到优化操作的目的。</p>
<h3 id="8-4-1-use-index"><a href="#8-4-1-use-index" class="headerlink" title="8.4.1 use index"></a>8.4.1 use index</h3><p>建议MySQL使用哪一个索引完成此次查询<strong>（仅仅是建议，MySQL内部还会再次进行评估）</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user use index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h3 id="8-4-2-ignore-index"><a href="#8-4-2-ignore-index" class="headerlink" title="8.4.2 ignore index"></a>8.4.2 ignore index</h3><p>忽略指定索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user ignore index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h3 id="8-4-3-force-index"><a href="#8-4-3-force-index" class="headerlink" title="8.4.3 force index"></a>8.4.3 force index</h3><p>强制使用索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user force index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>



<h3 id="8-4-4-案例"><a href="#8-4-4-案例" class="headerlink" title="8.4.4 案例"></a>8.4.4 案例</h3><ol>
<li><p>创建profession单列索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_user_pro <span class="hljs-keyword">on</span> tb_user(profession);<br></code></pre></td></tr></table></figure>
</li>
<li><p>执行sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/aa6ece6a1be99c3270ddf7f499f8fb9d.png" srcset="/img/loading.gif" lazyload alt="image-20230415221531884"></p>
<blockquote>
<p>此时发现，possible_keys（可能用到的索引）里出现了 idx_user_pro_age_sta（联合索引），idx_user_pro（上面刚刚建的单列索引），证明这两个索引都可能用到，但最终MySQL选择了idx_user_pro_age_sta索引。这是MySQL自动选择的结果。</p>
</blockquote>
</li>
<li><p>使用<code>use index</code></p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/10e1ae544d36b025211d438df875bc69.png" srcset="/img/loading.gif" lazyload alt="image-20230415221907817"></p>
<blockquote>
<p><strong>use index会让查询使用特定的索引而不是由查询优化器自动选择索引，当然MySQL内部还会再次进行评估。</strong></p>
<p><strong>这通常适用于查询优化器选择了错误的索引，即使在顶级查询执行计划中指定了正确的索引为主键也是如此。</strong></p>
<p><strong>此外，”USE INDEX”还可以用于强制覆盖查询优化器的限制以使用特定类型的访问方法，例如索引搜索或全表扫描。</strong></p>
</blockquote>
</li>
<li><p>使用<code>ignore index</code></p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/04404f21a3a11c0333a49229f2211a24.png" srcset="/img/loading.gif" lazyload alt="image-20230415222228055"></p>
<blockquote>
<p>可看出， <strong>ignore index会告诉MySQL不要使用特定的索引，即使它可以使用。</strong>使用其可以提高查询性能，因为MySQL不必在访问表时检查和使用指定的索引。”IGNORE INDEX”往往会对针对索引的特定查询语句产生积极的结果，但应谨慎使用以确保不会对全局查询性能造成不良的影响。</p>
</blockquote>
</li>
<li><p>使用<code>force index</code></p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/21d25f60469c92a04d0dc7e661d1d56e.png" srcset="/img/loading.gif" lazyload alt="image-20230415222440710"></p>
<blockquote>
<p> 可看出，<strong>force index用于告诉MySQL强制使用特定的索引，即使它不是最佳的索引。</strong></p>
<p>使用”FORCE INDEX”关键字可以让我们控制MySQL使用哪个索引来执行SELECT语句，以便获得更好的查询性能。</p>
<p>**如果强制使用错误的索引，就有可能得到错误的结果或者降低查询性能。</p>
<p>在使用”FORCE INDEX”时，<strong>应该先对查询进行优化，选择最适合的索引，然后再使用”FORCE INDEX”关键字。</strong>而且它只能影响单个查询。如果在整个应用程序中需要强制使用特定的索引，则需要更改表结构以强制使用索引。</p>
</blockquote>
</li>
</ol>
<h3 id="8-3-6-覆盖索引"><a href="#8-3-6-覆盖索引" class="headerlink" title="8.3.6 覆盖索引"></a>8.3.6 覆盖索引</h3><p>尽量使用覆盖索引，减少select。</p>
<p>覆盖索引是<strong>指查询使用了索引，并且需要返回的列，在该索引中已经全部能够找到</strong>。</p>
<h4 id="8-3-6-1-案例"><a href="#8-3-6-1-案例" class="headerlink" title="8.3.6.1 案例"></a>8.3.6.1 案例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> id, profession <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span><span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br><br>explain <span class="hljs-keyword">select</span> id,profession,age, status <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span><span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br><br>explain <span class="hljs-keyword">select</span> id,profession,age, status, name <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br><br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/34f43c3842db06ce1df3ff4aa7c29001.png" srcset="/img/loading.gif" lazyload alt="image-20230415224022379"></p>
<blockquote>
<p>差异点体现在后面的<code>Extra</code>；</p>
<p>前面两条SQL的结果为 Using where; Using Index ; </p>
<p>而后面两条SQL的结果为: Using index condition 。</p>
</blockquote>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/c8bbb8096e9488316a805baaa0f7322c.png" srcset="/img/loading.gif" lazyload alt="image-20230415224118913"></p>
<blockquote>
<p>在tb_user表中有一个联合索引 idx_user_pro_age_sta，该索引关联了三个字段 profession、age、status，而这个索引也是一个二级索引，所以叶子节点下面挂的是这一行的主键id。 所以当我们查询返回的数据在 id、profession、age、status 之中，则直接走二级索引直接返回数据了。 如果超出这个范围，就需要拿到主键id，再去扫描聚集索引，再获取额外的数据。</p>
<p> 而我们如果一直使用select * 查询返回所有字段值，很容易就会造成回表查询（除非是根据主键查询，此时只会扫描聚集索引）。</p>
</blockquote>
<p>表结构以及索引示意图</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/ff43e8af4fdb141f045a10beacbba736.png" srcset="/img/loading.gif" lazyload alt="image-20230416205452727"></p>
<blockquote>
<p>id是主键，是一个聚集索引。 name字段建立了普通索引，是一个二级索引（辅助索引）。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/d2117d1cbacca3fc3153bda61b317e7e.png" srcset="/img/loading.gif" lazyload alt="image-20230416210004818"></p>
<p>此时根据id查询，<strong>直接走聚集索引查询，一次索引扫描，直接返回数据，性能高。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">selet id,name <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Arm&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/7276d259290cbe9d1ec6d1e73bde0c1f.png" srcset="/img/loading.gif" lazyload alt="image-20230416210122145"></p>
<p>虽然是根据name字段查询，查询二级索引，但是由于查询返回在字段为 id，name，<strong>在name的二级索引中，这两个值都是可以直接获取到的，因为覆盖索引，所以不需要回表查询，性能高。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">selet id,name,gender <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Arm&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/458c2f840c087d0185c142a52f187b60.png" srcset="/img/loading.gif" lazyload alt="image-20230416210235537"></p>
<p>由于在name的二级索引中，不包含gender，所以，<strong>需要两次索引扫描，也就是需要回表查询，性能相对较差一点。</strong></p>
<blockquote>
<p>有一张表，有四个字段(id, username, password, status), 由于数据量大, 需要对 以下SQL语句进行优化, 该如何进行才是最优方案:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id,username,password <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> username <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;itcast&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>解决办法：</p>
<p>针对username和password建立联合索引，这样就可以查询二级索引的时候，返回的字段为id,username,password。此时可以避免回表查询，性能较好。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_user_name_pass <span class="hljs-keyword">on</span> tb_user(username,password); <br></code></pre></td></tr></table></figure>


</blockquote>
<h2 id="8-5-前缀索引"><a href="#8-5-前缀索引" class="headerlink" title="8.5 前缀索引"></a>8.5 前缀索引</h2><p> 当字段类型为字符串（varchar，text，longtext等）时，有时候需要索引很长的字符串，这会让索引变得很大，查询时，浪费大量的磁盘IO， 影响查询效率。</p>
<p><strong>此时可以只将字符串的一部分前缀，建立索引，这样可以大大节约索引空间，从而提高索引效率。</strong></p>
<h3 id="8-5-1-语法"><a href="#8-5-1-语法" class="headerlink" title="8.5.1 语法"></a>8.5.1 语法</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_xxxx <span class="hljs-keyword">on</span> table_name(<span class="hljs-keyword">column</span>(n)) ;<br></code></pre></td></tr></table></figure>

<h3 id="8-5-2-前缀长度"><a href="#8-5-2-前缀长度" class="headerlink" title="8.5.2 前缀长度"></a>8.5.2 前缀长度</h3><p>可以<strong>根据索引的选择性来决定</strong>，而<strong>选择性是指不重复的索引值（基数）和数据表的记录总数的比值</strong>， <strong>索引选择性越高则查询效率越高</strong>， <strong>唯一索引</strong>的选择性是<strong>1</strong>，这是<strong>最好</strong>的索引选择性，性能也是最好的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql">#示例<br>#求email中不重复的索引值（基数）<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> email) <span class="hljs-keyword">from</span> tb_user;<br>#求数据表中记录总数，也就是求数据表中的所有数据<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_user;<br>#两个的比值即为索引的选择性<br><br>#上面两条语句也可以结合在一起，直接就可以输出索引的选择性<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> email) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_user ;<br><br>#也可以选择几个前缀。平衡前缀和选择性之间的关系，如选择前五个前缀的选择性<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> <span class="hljs-built_in">substring</span>(email,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>)) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_user ;<br></code></pre></td></tr></table></figure>



<h3 id="8-5-3-示例"><a href="#8-5-3-示例" class="headerlink" title="8.5.3 示例"></a>8.5.3 示例</h3><p>为tb_user表的email字段，建立长度为5<strong>【5指查询的字段的长度，并不是表内前5个的数据】</strong>的前缀索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_email_5 <span class="hljs-keyword">on</span> tb_user(email(<span class="hljs-number">5</span>)) ;<br></code></pre></td></tr></table></figure>

<p>查询’<a href="mailto:&#99;&#97;&#x6f;&#99;&#97;&#x6f;&#54;&#x36;&#x36;&#64;&#113;&#113;&#46;&#x63;&#111;&#x6d;">&#99;&#97;&#x6f;&#99;&#97;&#x6f;&#54;&#x36;&#x36;&#64;&#113;&#113;&#46;&#x63;&#111;&#x6d;</a>’ ，<strong>【在这里，索引会根据长度为5进行查询，即查询caoca】</strong>看看是否使用到我们为它建的前缀索引</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/8296044054c14a2068fd15901b0fa1a7.png" srcset="/img/loading.gif" lazyload alt="image-20230416213245736"></p>
<p>前缀索引的查询流程</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/88e73c179fc43ea2e54de3689bff4d1c.png" srcset="/img/loading.gif" lazyload alt="image-20230416213433677"></p>
<h2 id="8-6-单列索引和联合索引"><a href="#8-6-单列索引和联合索引" class="headerlink" title="8.6 单列索引和联合索引"></a>8.6 单列索引和联合索引</h2><p>单列索引：即一个索引只包含<strong>单</strong>个列。</p>
<p>联合索引：即一个索引包含了<strong>多</strong>个列。</p>
<p>目前tb_user 表中目前的索引情况是既有单列索引，又有联合索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> id,phone,name <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990014&#x27;</span> <span class="hljs-keyword">and</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;貂蝉&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/41962cfc00054e66135e917fcf0359ad.png" srcset="/img/loading.gif" lazyload alt="image-20230416214526350"></p>
<p>通过上述执行计划我们可以看出来，在and连接的两个字段 phone、name上都是有单列索引的，但是最终mysql只会选择一个索引，也就是说，<strong>只能走一个字段的索引，此时是会回表查询的。</strong></p>
<p>创建一个phone和name字段的联合索引来查询一下执行计划。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">unique</span> index idx_user_phone_name <span class="hljs-keyword">on</span> tb_user(phone,name);<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/d04ddd7dae3a62ffc097009aa49e2d8a.png" srcset="/img/loading.gif" lazyload alt="image-20230416214952798"></p>
<p>MySQL依旧选择单列索引，此时我们使用use index 让MySQL用我们所建的联合索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> id,phone,name <span class="hljs-keyword">from</span> tb_user use index(idx_user_phone_name) <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990014&#x27;</span> <span class="hljs-keyword">and</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;貂蝉&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/7fb6608961f507cc3fb711fcf3b87d1c.png" srcset="/img/loading.gif" lazyload alt="image-20230416215308884"></p>
<p>此时，查询时，就走了联合索引，而<strong>在联合索引中包含 phone、name的信息，在叶子节点下挂的是对应的主键id，所以查询是无需回表查询的。</strong></p>
<blockquote>
<p>如果存在多个查询条件，考虑针对于查询字段建立索引时，建议建立联合索引， 而非单列索引。</p>
</blockquote>
<p>当查询使用联合索引时，具体结构：</p>
<p><img src="https://mypc-1313021454.cos.ap-beijing.myqcloud.com/MySQL/d7ae8e87756a8c0472a4465883f9370c.png" srcset="/img/loading.gif" lazyload alt="image-20230416215530502"></p>
<h1 id="9-索引设计原则"><a href="#9-索引设计原则" class="headerlink" title="9. 索引设计原则"></a>9. 索引设计原则</h1><ol>
<li>针对于数据量较大（业务中数据量超过一百万），且查询比较频繁的表建立索引。</li>
<li>针对于常作为查询条件（where）、排序（order by）、分组（group by）操作的字段建立索 引。</li>
<li>尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高。</li>
<li>如果是字符串类型的字段，字段的长度较长，可以针对于字段的特点，建立前缀索引。</li>
<li>尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间， 避免回表，提高查询效率。</li>
<li>要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价也就越大，会影响增删改的效率。</li>
<li>如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含 NULL值时，它可以更好地确定哪个索引最有效地用于查询。</li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/MySQL/" class="category-chain-item">MySQL</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/MySQL/" class="print-no-link">#MySQL</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MySQL-进阶-索引</div>
      <div>https://baijianglai.cn/MySQL-进阶-索引/67c1cc216a26/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Lai Baijiang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年4月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/%E9%9D%A2%E8%AF%95-redis/e3a811c2f1b6/" title="面试-redis">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">面试-redis</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/MySQL-%E8%BF%9B%E9%98%B6-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/287076446eca/" title="MySQL-进阶-存储引擎">
                        <span class="hidden-mobile">MySQL-进阶-存储引擎</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
